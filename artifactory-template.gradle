artifactory {
    contextUrl = "http://longlinkislong.com:8080/artifactory/"
    publish {
        repository {
            repoKey = "libs-${buildType}-local"
            username = "${artifactoryUser}"
            password = "${artifactoryPassword}"
            maven = true
        }
        defaults {
            publications ('mavenJava')
        }
    }    
}
 
publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
            groupId = "${group}"
            
            if(buildType == 'release') {
                def versionPropsFile = new File('version.properties')
    
                if(!versionPropsFile.exists()) {
                    def versionProps = new Properties()
        
                    versionProps['major'] = '1'
                    versionProps['minor'] = '0'
                    versionProps['revision'] = '0'
        
                    versionProps.store(versionPropsFile.newWriter(), null)
                    
                    version = "1.0r0"
                } else if(versionPropsFile.canRead()) {
                    def versionProps = new Properties()
        
                    versionProps.load(new FileInputStream(versionPropsFile))
        
                    def major = versionProps['major']
                    def minor = versionProps['minor']
                    def revision = versionProps['revision'].toInteger() + 1
                    
                    versionProps['revision'] = revision.toString()
                    
                    versionProps.store(versionPropsFile.newWriter(), null)
        
                    version = "${major}.${minor}r${revision}"
                }
            } else {
                version = new Date().format('yy.MM') + "-SNAPSHOT"
            }                        
        }
    }
}